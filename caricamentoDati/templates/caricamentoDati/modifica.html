{% extends 'base.html' %}
{% block title %}
  Modifica
{% endblock %}
{% block content %}
  <div class="main">
    <h1>Modifica {{ valutazione.nome }}, {{ valutazione.anno }}. Pubblicazioni richieste per autore: {{ valutazione.numeroPubblicazioni }}</h1>
    <div style="display: flex;">
      <div style="padding: 20px;">
        <h2>Cancella tutte le pubblicazioni</h2>
        <form method="post" action="{% url 'cancella_pubblicazioni_tot' valutazione.nome %}">
          {% csrf_token %}

          <button class="btn" type="submit">Cancella</button>
        </form>
      </div>
      <div style="padding: 20px;">
        <h2>Carica pubblicazioni</h2>
        <form method="post" enctype="multipart/form-data" action="{% url 'caricamento_con_file' filename='temp' valutazione=valutazione.nome %}">
          {% csrf_token %}
          <label for="filename">Seleziona un file CSV:</label>
          <input type="file" name="filename" id="filename" />
          <br />
          <button class="btn" type="submit">Carica</button>
        </form>
      </div>

      <div style="padding: 20px;">
        <h2>Carica nuova pubblicazione</h2>

        <button onclick="openPopup()" class="btn">Aggiungi pubblicazione</button>

        <script>
          function openPopup() {
            var url = "{% url 'aggiungi_pubblicazione_pagina' valutazione_nome=valutazione.nome caller='modifica' docente='admin' %}"
            window.open(url, 'popupWindow', 'width=1800,height=800,scrollbars=yes')
          }
        </script>
      </div>

      <div style="padding: 20px;">
        <h2>Riviste eccellenti</h2>

        <button onclick="openPopup2()" class="btn">Modifica riviste eccellenti</button>

        <script>
          function openPopup2() {
            var url = "{% url 'riviste_eccellenti' valutazione_nome=valutazione.nome %}"
            window.open(url, 'popupWindow', 'width=1800,height=800,scrollbars=yes')
          }
        </script>
      </div>
    </div>
    <div style="padding-top: 80px;">
      {% if pubblicazioni %}
        <h2>Pubblicazioni</h2>
        <table id="table-pubblicazioni" class="table table-bordered">
          <thead>
            <tr>
              <th style="vertical-align: top; text-align: left;" data-orderable="true">
                <b>Titolo</b>
              </th>
              <th data-orderable="true" style="vertical-align: top; text-align: left;">
                <b>Anno di pubblicazione</b>
              </th>
              <th data-orderable="true" style="vertical-align: top; text-align: left;">
                <b>Miglior quartile</b>
              </th>
              <th data-orderable="true" style="vertical-align: top; text-align: left;">
                <b>Numero di coautori del dipartimento</b>
              </th>
              <th style="vertical-align: top; text-align: left;">
                <b>Azioni</b>
              </th>
            </tr>
          </thead>
          {% for pubblicazione in pubblicazioni %}
            <tr>
              <td>{{ pubblicazione.titolo }}</td>
              <td>{{ pubblicazione.anno_pubblicazione }}</td>
              <td>{{ pubblicazione.miglior_quartile }}</td>
              <td>{{ pubblicazione.num_coautori_dip }}</td>
              <td>
                <div type="button" style="padding-left: 40px;">
                  <form method="post" action="{% url 'cancella_pubblicazione_singola' valutazione_nome=valutazione.nome pubblicazione_titolo=pubblicazione.titolo %}">
                    {% csrf_token %}

                    <button class="btn" type="submit">Cancella</button>
                  </form>
                </div>
              </td>
            </tr>
          {% endfor %}
        </table>
      {% else %}
        <p>Non ci sono pubblicazioni disponibili.</p>
      {% endif %}
    </div>
  </div>
{% endblock %}
